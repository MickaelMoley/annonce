{% extends 'base.html.twig' %}
{% block head %}
    {{ parent() }}

{% endblock %}
{% block title %} Site d'annonces auto {% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('assets/css/glide.core.css') }}">
    <style>
        .swiper-container {
            width: 100%;
            height: 500px;
            background: #000;
        }

        .swiper-slide:before {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            content: ' ';
            background-color: rgba(0, 0, 0, 0.5);
        }

        .swiper-slide {
            font-size: 18px;
            color: #fff;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            padding: 40px 60px;
        }

        .parallax-bg {
            position: absolute;
            left: 0;
            top: 0;
            width: 130%;
            height: 100%;
            -webkit-background-size: cover;
            background-size: cover;
            background-position: center;
        }

        .swiper-slide .title {
            font-size: 41px;
            font-weight: 300;
        }

        .swiper-slide .subtitle {
            font-size: 21px;
        }

        .swiper-slide .text {
            font-size: 14px;
            max-width: 400px;
            line-height: 1.3;
        }
    </style>
{% endblock %}
{% block body %}
    <div class="hero-wrap img"
         style="background-image: url({{ asset('assets/images/bg.jpg') }});background-position:50% 90%">
        <div class="overlay"></div>
        <div class="container">
            <div class="row d-md-flex no-gutters slider-text align-items-center justify-content-center">
                <div class="col-md-10 d-flex align-items-center ftco-animate">
                    <div class="text text-center pt-3 mt-md-3">
                        <h1 class="mb-5">Trouver la voiture qui te correspond.</h1>

                        <div class="ftco-search my-md-5">
                            <div class="row">
                                <div class="col-md-12 nav-link-wrap">
                                    <div class="nav nav-pills text-center" id="v-pills-tab" role="tablist"
                                         aria-orientation="vertical">
                                        <a class="nav-link active mr-md-1" id="v-pills-1-tab" data-toggle="pill"
                                           href="#v-pills-1" role="tab" aria-controls="v-pills-1"
                                           aria-selected="true">Trouver un véhicule</a>
                                    </div>
                                </div>
                                <div class="col-md-12 tab-wrap">

                                    <div class="tab-content p-4" id="v-pills-tabContent">

                                        <div class="tab-pane fade show active" id="v-pills-1" role="tabpanel"
                                             aria-labelledby="v-pills-nextgen-tab">
                                            <form action="{{ path('annonces') }}" class="search-annonce">
                                                <div class="row no-gutters">
                                                    <div class="col-md mr-md-2">
                                                        <div class="form-group">
                                                            <div class="form-field">
                                                                <div class="icon"><span class="icon-search"></span>
                                                                </div>
                                                                <input type="text" name="q" class="form-control"
                                                                       placeholder="Mot clé">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md mr-md-2">
                                                        <div class="form-group">
                                                            <div class="form-field">
                                                                <div class="select-wrap">
                                                                    <select name="make" id="make-filter"
                                                                            class=" selectpicker"
                                                                            data-live-search="true">
                                                                        <option value="">Marque</option>
                                                                        {% if makes is defined and makes is not empty %}
                                                                            {% for make in makes %}
                                                                                <option value="{{ make|lower }}">{{ make }}</option>
                                                                            {% endfor %}
                                                                        {% endif %}
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md mr-md-2">
                                                        <div class="form-group">
                                                            <div class="form-field">
                                                                <div class="select-wrap">
                                                                    <select name="model" id="model-select"
                                                                            class=" selectpicker">
                                                                        <option value="">Modèle</option>
                                                                        {% if models is defined and models is not empty %}
                                                                            {% for model in models %}
                                                                                <option value="{{ model|lower }}">{{ model }}</option>
                                                                            {% endfor %}
                                                                        {% endif %}
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md">
                                                        <div class="form-group">
                                                            <div class="form-field">
                                                                <button type="submit"
                                                                        class="form-control btn btn-primary">Chercher
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <section class="py-3 ftco-counter">
        <div class="container">
            <div class="row">
                <div class="col-6 col-lg-3 mb-3">
                    <div class="text-center">
                        <span class="d-block font-weight-bold text-dark number" style="font-size: xx-large" data-number="{{ annonces.getTotalItemCount }}">+ </span>
                        <span class="d-block" style="font-size: medium">Annonces</span>
                    </div>
                </div>
                <div class="col-6 col-lg-3 mb-3">
                    <div class="text-center">
                        <span class="d-block font-weight-bold text-dark number" style="font-size: xx-large" data-number="{{ makes|length}}"></span>
                        <span class="d-block" style="font-size: medium">Marques</span>
                    </div>
                </div>
                <div class="col-6 col-lg-3 mb-3">
                    <div class="text-center">
                        <span class="d-block font-weight-bold text-dark number" style="font-size: xx-large" data-number="{{ models |length}}"></span>
                        <span class="d-block" style="font-size: medium">Modèles</span>
                    </div>
                </div>
                <div class="col-6 col-lg-3 mb-3" >
                    <div class="text-center">
                        <span class="d-block font-weight-bold text-dark number" style="font-size: xx-large" data-number="25">+ </span>
                        <span class="d-block" style="font-size: medium">Partenaires</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="ftco-section">
        <div class="container">
            <div class="row justify-content-center mb-5">
                <div class="col-md-7 heading-section text-center ftco-animate">
                    <h2 class="mb-0">Trouve la voiture de tes rêves</h2>
                    <p class="lead">Nous vous proposons tous une série d'annonces afin de trouver la voiture qui vous
                        correspond.</p>
                </div>
            </div>
            <div class="row align-items-end">
                <div class="col-12 col-md-4 ftco-animate text-center">
                    <img src="{{ asset('assets/images/undraw_people_search_wctu.png') }}" alt="" class="img-fluid">
                    <h3 class="mt-3 font-weight-bold">Trouver</h3>
                    <p>Nous pouvons vous aider à trouver la voiture qui vous correspond. Nous vous proposons un
                        catalogue de tous types de véhicules</p>
                </div>
                <div class="col-12 col-md-4 ftco-animate text-center">
                    <img src="{{ asset('assets/images/undraw_contact_us_15o2.svg') }}" alt="" class="img-fluid">
                    <h3 class="mt-3 font-weight-bold">Nous contacter</h3>
                    <p>Une fois que vous avez trouvez votre véhicule vous pouvez nous contacter en utilisant notre
                        formulaire de contact ou par téléphone</p>
                </div>
                <div class="col-12 col-md-4 ftco-animate text-center">
                    <img src="{{ asset('assets/images/undraw_city_driver_jh2h.svg') }}" alt="" class="img-fluid">
                    <h3 class="mt-3 font-weight-bold">Roulez</h3>
                    <p>Profitez de votre nouveau véhicule obtenu grâce à nos annonces. Si vous êtes une société, vous
                        pouvez le revendre</p>
                </div>
            </div>
        </div>
    </section>


    <section class="ftco-section bg-light ftco-animate">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 ">
                    <div class="row justify-content-center pb-3">
                        <div class="col-md-12 heading-section ftco-animate">
                            <h2 class="mb-4">Les annonces les plus récents</h2>
                            <p class="lead text-black-50">Nous vous proposons tous une série d'annonces afin de trouver
                                la voiture qui vous
                                correspond.</p>
                        </div>
                    </div>
                    <div class="row">
                        {% if annonces|length > 0 %}
                            {% for annonce in annonces %}
                                <div class="col-md-6 ftco-animate">


                                    <div class="card mb-3" style="max-width: 540px;">
                                        <div class="row no-gutters">
                                            <div class="col-md-4">
                                                <img src="{% if annonce.image[0].url is iterable %}{{ annonce.image[0].url[0] }}{% else %} {{ annonce.image[0].url }} {% endif %}"
                                                     class="card-img" style="object-fit: contain"
                                                     alt="Image de {{ annonce.make }} {{ annonce.model }}"">
                                            </div>
                                            <div class="col-md-8">
                                                <div class="card-body">
                                                    <h5 class="card-title"><a class="text-dark"
                                                                              href="{{ path('annonce', {'slug': annonce.slug }) }}"
                                                                              title="Voir cette annonce : {{ annonce.make }} - {{ annonce.model }}">{{ annonce.title }}</a>
                                                    </h5>
                                                    <p class="card-text">This is a wider card with supporting text below
                                                        as a natural lead-in to additional content. This content is a
                                                        little bit longer.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            {% endfor %}

                        {% else %}
                            <div class="p-5 bg-gray d-flex justify-content-center align-items-center">
                                <p><i class="fas fa-search mr-2"></i>Aucunes annonces ne correspond à vos critères.
                                </p>
                            </div>


                        {% endif %}


                    </div>
                    <a href="{{ path('annonces') }}" class="text-dark font-weight-bold" title="Voir tous les annonces">Afficher
                        tous les annonces ({{ annonces.getTotalItemCount }}) <i class="fa fa-arrow-right"></i></a>
                </div>
                <div class="col-lg-3 sidebar">
                    <!-- PUB -->
                </div>
            </div>
        </div>
    </section>


{% endblock %}
{% block javascripts %}

    {{ parent() }}

    <script>
        var swiper = new Swiper('.swiper-container', {
            speed: 600,
            parallax: true,
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
        });


    </script>
    <script>
        $('#make-filter').on('changed.bs.select', function (e, clickedIndex, isSelected, previousValue) {
            $.post('{{ path('api_fetchModelByMake') }}', {make: this.value, state: 'all'})
                .done(function (data) {

                    $('#model-select')
                        .empty()
                        .append(`<option value="">Modèle</option>`);
                    if (data) {
                        data.forEach((element) => {
                            $item = element.model ? element.model : element;

                            $('#model-select')
                                .append(`<option value="${$item.toLowerCase()}">${$item}</option>`);
                        });
                        $('#model-select')
                            .selectpicker('refresh');
                    }

                })
            ;
        });


    </script>

{% endblock %}